# Nexus Sa√∫de - AI Medical Assistant (TypeScript)

Este √© o servi√ßo de Assistente M√©dico com IA convertido de Python para TypeScript, fornecendo capacidades inteligentes de assist√™ncia m√©dica para profissionais de sa√∫de.

## üöÄ Funcionalidades

### Capacidades Principais
- **Processamento de Linguagem Natural M√©dica**: Extrai entidades m√©dicas de texto
- **Sugest√µes Diagn√≥sticas**: Gera sugest√µes baseadas em sintomas
- **Recomenda√ß√µes de Tratamento**: Sugere protocolos de tratamento
- **Gerenciamento de Conversas**: Mant√©m contexto de conversas m√©dicas
- **Base de Conhecimento M√©dica**: Sistema de conhecimento m√©dico integrado

### Funcionalidades Avan√ßadas
- **An√°lise de Urg√™ncia**: Avalia n√≠veis de urg√™ncia m√©dica
- **Detec√ß√£o de Red Flags**: Identifica sintomas de emerg√™ncia
- **Recomenda√ß√µes Personalizadas**: Baseadas no contexto do paciente
- **Monitoramento e M√©tricas**: Sistema completo de observabilidade
- **Integra√ß√£o com OpenAI**: Suporte opcional para GPT models

## üèóÔ∏è Arquitetura

### Stack Tecnol√≥gico
- **Runtime**: Node.js 18+ com TypeScript
- **Framework**: Fastify (high-performance web framework)
- **Database**: PostgreSQL 15+
- **Cache**: Redis 7+
- **NLP**: Natural.js + libraries espec√≠ficas
- **Monitoramento**: Prometheus + m√©tricas customizadas
- **Containeriza√ß√£o**: Docker + Docker Compose

### Componentes Principais

```
src/
‚îú‚îÄ‚îÄ core/                    # Componentes principais
‚îÇ   ‚îú‚îÄ‚îÄ medical-assistant.ts # Assistente m√©dico principal
‚îÇ   ‚îú‚îÄ‚îÄ medical-knowledge.ts # Base de conhecimento
‚îÇ   ‚îú‚îÄ‚îÄ medical-nlp.ts      # Processamento NLP
‚îÇ   ‚îú‚îÄ‚îÄ conversation-manager.ts # Gerenciamento de conversas
‚îÇ   ‚îú‚îÄ‚îÄ medical-recommendation.ts # Motor de recomenda√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ database.ts         # Servi√ßo de banco de dados
‚îÇ   ‚îî‚îÄ‚îÄ monitoring.ts       # Servi√ßo de monitoramento
‚îú‚îÄ‚îÄ routes/                 # Rotas da API
‚îú‚îÄ‚îÄ config/                 # Configura√ß√µes
‚îú‚îÄ‚îÄ utils/                  # Utilit√°rios
‚îî‚îÄ‚îÄ index.ts               # Ponto de entrada
```

## üîß Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos
- Node.js 18+
- pnpm (gerenciador de pacotes)
- Docker e Docker Compose (para containeriza√ß√£o)
- PostgreSQL 15+ (se n√£o usar Docker)
- Redis 7+ (se n√£o usar Docker)

### Instala√ß√£o Local

1. **Clone e instale depend√™ncias**:
```bash
cd services/ai-ts
pnpm install
```

2. **Configure vari√°veis de ambiente**:
```bash
cp .env.example .env
# Edite o arquivo .env com suas configura√ß√µes
```

3. **Execute em modo desenvolvimento**:
```bash
pnpm run dev
```

### Usando Docker

1. **Build e execute com Docker Compose**:
```bash
docker-compose up -d
```

2. **Verifique os logs**:
```bash
docker-compose logs -f ai-assistant
```

## üìã Configura√ß√£o

### Vari√°veis de Ambiente Principais

```env
# Configura√ß√£o do Servi√ßo
NODE_ENV=development
AI_HOST=0.0.0.0
AI_PORT=8002
DEBUG=true

# Banco de Dados
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/nexus_saude
DB_MAX_CONNECTIONS=20

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=1

# OpenAI (Opcional)
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=gpt-3.5-turbo
ENABLE_OPENAI=false

# Configura√ß√µes de IA
ENABLE_LOCAL_MODELS=true
MODEL_LOAD_TIMEOUT=60000
SENTENCE_TRANSFORMER_MODEL=all-MiniLM-L6-v2

# Base de Conhecimento
MEDICAL_KNOWLEDGE_PATH=./data/medical_knowledge
ENABLE_MEDICAL_DB=true

# Conversas
CONVERSATION_TIMEOUT=30
MAX_CONVERSATION_MEMORY=20

# Monitoramento
ENABLE_METRICS=true
METRICS_PORT=9002
LOG_LEVEL=info
```

## üåê API Endpoints

### Principais Endpoints

#### Assistente M√©dico
```http
POST /api/v1/assistant/query
Content-Type: application/json

{
  "query": "Paciente apresenta dor no peito e dificuldade para respirar",
  "patientContext": {
    "age": 45,
    "gender": "M",
    "medicalHistory": ["hipertens√£o"],
    "currentMedications": ["lisinopril"]
  },
  "conversationId": "uuid-optional"
}
```

#### Sugest√µes Diagn√≥sticas
```http
POST /api/v1/diagnostic/suggestions
Content-Type: application/json

{
  "symptoms": ["dor no peito", "dificuldade respirar", "sudorese"],
  "patientInfo": {
    "age": 45,
    "gender": "M",
    "medicalHistory": ["hipertens√£o"]
  }
}
```

#### Recomenda√ß√µes de Tratamento
```http
POST /api/v1/treatment/recommendations
Content-Type: application/json

{
  "diagnosis": "hipertens√£o",
  "patientInfo": {
    "age": 45,
    "gender": "M",
    "allergies": ["penicilina"]
  },
  "severity": "moderate"
}
```

### Endpoints de Monitoramento

- **Health Check**: `GET /health`
- **Ready Check**: `GET /ready`
- **Status Report**: `GET /status`
- **Metrics (Prometheus)**: `GET /metrics`
- **API Documentation**: `GET /docs`

## üìä Monitoramento e M√©tricas

### M√©tricas Dispon√≠veis

#### Sistema
- Uso de mem√≥ria e CPU
- Tempo de resposta m√©dio
- Conex√µes ativas
- Uptime do servi√ßo

#### IA Espec√≠fica
- Total de queries processadas
- Queries por minuto
- Confian√ßa m√©dia das respostas
- Tempo m√©dio de processamento
- Taxa de erro
- Tempo de carregamento de modelos

#### Sa√∫de dos Componentes
- Status da base de dados
- Status dos modelos de IA
- Status da base de conhecimento
- Status do Redis

### Dashboards

M√©tricas s√£o expostas no formato Prometheus em `/metrics` e podem ser visualizadas com:
- Grafana (dashboards customizados)
- Prometheus (m√©tricas raw)
- Status endpoint (relat√≥rio JSON)

## üß™ Desenvolvimento e Testes

### Scripts Dispon√≠veis

```bash
# Desenvolvimento
pnpm run dev          # Executa em modo desenvolvimento
pnpm run build        # Build para produ√ß√£o
pnpm run start        # Executa vers√£o de produ√ß√£o

# Qualidade de C√≥digo
pnpm run lint         # Executa linting
pnpm run lint:fix     # Corrige problemas de linting
pnpm run test         # Executa testes
pnpm run test:watch   # Executa testes em modo watch

# Docker
pnpm run docker:build  # Build da imagem Docker
pnpm run docker:run    # Executa container Docker
```

### Estrutura de Testes

```
tests/
‚îú‚îÄ‚îÄ unit/              # Testes unit√°rios
‚îú‚îÄ‚îÄ integration/       # Testes de integra√ß√£o
‚îú‚îÄ‚îÄ e2e/              # Testes end-to-end
‚îî‚îÄ‚îÄ fixtures/         # Dados de teste
```

## üöÄ Performance e Otimiza√ß√µes

### Melhorias vs Vers√£o Python

- **~3x mais r√°pido**: Processamento de requests
- **~60% menos mem√≥ria**: Footprint reduzido
- **Melhor concorr√™ncia**: Event loop do Node.js
- **Startup mais r√°pido**: Carregamento otimizado

### Otimiza√ß√µes Implementadas

1. **Cache Inteligente**: Redis para conversas e resultados
2. **Connection Pooling**: PostgreSQL com pool otimizado
3. **Lazy Loading**: Modelos carregados sob demanda
4. **Compress√£o**: Gzip para responses HTTP
5. **Rate Limiting**: Prote√ß√£o contra abuse
6. **Memory Management**: Limpeza autom√°tica de recursos

## üîê Seguran√ßa

### Medidas Implementadas

- **Helmet.js**: Prote√ß√£o contra vulnerabilidades web
- **Rate Limiting**: Preven√ß√£o de ataques DDoS
- **Input Validation**: Valida√ß√£o rigorosa com Zod
- **CORS**: Configura√ß√£o de origens permitidas
- **Container Security**: Usu√°rio n√£o-root, imagem minimal
- **Secrets Management**: Vari√°veis de ambiente para credenciais

## üìö Base de Conhecimento M√©dica

### Fontes de Dados

- Condi√ß√µes m√©dicas e sintomas
- Medicamentos e intera√ß√µes
- Procedimentos e protocolos
- Guidelines cl√≠nicos
- Protocolos de tratamento

### Atualiza√ß√£o

- **Autom√°tica**: Sincroniza√ß√£o peri√≥dica (configur√°vel)
- **Manual**: Via API administrativa
- **Versionamento**: Controle de vers√µes do conhecimento

## üîÑ Migra√ß√£o da Vers√£o Python

### Compatibilidade

- **API**: 100% compat√≠vel com a vers√£o Python
- **Dados**: Migra√ß√£o autom√°tica do banco de dados
- **Configura√ß√µes**: Mapeamento de configura√ß√µes
- **Funcionalidades**: Paridade completa + melhorias

### Benef√≠cios da Migra√ß√£o

1. **Performance**: Significativamente mais r√°pido
2. **Maintainability**: Tipagem est√°tica TypeScript
3. **Ecosystem**: Integra√ß√£o com stack Node.js
4. **Resource Usage**: Menor consumo de recursos
5. **Developer Experience**: Melhor debugging e tooling

## üöÄ Deploy em Produ√ß√£o

### Docker Compose (Recomendado)

```bash
# Clone do reposit√≥rio
git clone <repo>
cd nexus-saude/services/ai-ts

# Configure vari√°veis de ambiente
cp .env.example .env
# Edite .env com configura√ß√µes de produ√ß√£o

# Deploy
docker-compose -f docker-compose.yml up -d

# Verifica√ß√£o
curl http://localhost:8002/health
```

### Kubernetes (Avan√ßado)

```yaml
# Exemplo de deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ai-assistant
spec:
  replicas: 3
  selector:
    matchLabels:
      app: ai-assistant
  template:
    metadata:
      labels:
        app: ai-assistant
    spec:
      containers:
      - name: ai-assistant
        image: nexus-ai-assistant:latest
        ports:
        - containerPort: 8002
        env:
        - name: NODE_ENV
          value: "production"
        # ... outras configura√ß√µes
```

## üìû Suporte e Troubleshooting

### Logs

```bash
# Docker Compose
docker-compose logs -f ai-assistant

# Kubernetes
kubectl logs -f deployment/ai-assistant
```

### Health Checks

```bash
# Verifica√ß√£o r√°pida
curl http://localhost:8002/health

# Status detalhado
curl http://localhost:8002/status

# M√©tricas
curl http://localhost:8002/metrics
```

### Problemas Comuns

1. **Modelos n√£o carregam**: Verifique `MODEL_LOAD_TIMEOUT`
2. **Conectividade BD**: Verifique `DATABASE_URL`
3. **Mem√≥ria insuficiente**: Aumente limits do container
4. **Performance**: Verifique m√©tricas em `/metrics`

## ü§ù Contribui√ß√£o

### Guidelines

1. **TypeScript**: C√≥digo deve ser tipado
2. **Tests**: Testes para novas funcionalidades
3. **Documentation**: Documente APIs e mudan√ßas
4. **Linting**: Siga as regras do ESLint
5. **Performance**: Considere impacto na performance

### Processo

1. Fork do reposit√≥rio
2. Crie feature branch
3. Implemente com testes
4. Execute linting e testes
5. Abra Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob licen√ßa MIT. Veja o arquivo LICENSE para detalhes.

---

**Nexus Sa√∫de Team** - Transformando sa√∫de com tecnologia üè•üíª